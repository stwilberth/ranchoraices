---
import { languages, getLangFromUrl } from '../i18n.js';
import '../styles/global.css';
import ScrollToTop from './ScrollToTop.astro';

const { url = new URL('http://localhost/') } = Astro.props;
const lang = getLangFromUrl(url);
const t = languages[lang];
const link_class = "hover:text-amber-400 transition";
---
<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{t.siteName}</title>
    <meta name="description" content={t.heroSubtitle} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  </head>
  <body class="bg-amber-50 text-gray-900 min-h-screen flex flex-col">
    <header class="w-full py-4 px-6 flex items-center justify-between bg-amber-900 text-amber-50 shadow-md relative sticky top-0 z-50">
      <div class="text-2xl font-display tracking-wide">
        <a href={lang === 'es' ? '/' : '/en/'}>{t.siteName}</a>
      </div>
      
      <button id="menu-btn" class="md:hidden block text-amber-50 hover:text-amber-400 focus:outline-none z-50 transition-transform hover:scale-110" aria-label="Menu">
        <svg id="menu-icon" class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <svg id="close-icon" class="w-8 h-8 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>

      <!-- Desktop Menu -->
      <nav class="hidden md:flex items-center gap-6 text-lg">
        <a href={lang === 'es' ? '/' : '/en/'} class={link_class}>{t.home}</a>
        <a href={lang === 'es' ? '/tours' : '/en/tours'} class={link_class}>{t.tours}</a>
        <a href={lang === 'es' ? '/about' : '/en/about'} class={link_class}>{t.about}</a>
        <a href={lang === 'es' ? '/gallery' : '/en/gallery'} class={link_class}>{t.gallery}</a>
        <a href={lang === 'es' ? '/contact' : '/en/contact'} class={link_class}>{t.contact}</a>
        <a href={lang === 'es' ? '/en' : '/'} class="ml-4 px-3 py-1 rounded bg-amber-400 text-amber-900 font-semibold hover:bg-green-600 hover:text-white transition">{t.switchLang}</a>
      </nav>
    </header>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-40 opacity-0 pointer-events-none transition-opacity duration-300">
      <div class="fixed bottom-0 left-0 right-0 bg-amber-900/95 rounded-t-3xl p-6 transform translate-y-full transition-transform duration-300 ease-in-out">
        <div class="flex justify-end mb-4">
          <button id="close-menu-btn" class="text-amber-50 hover:text-amber-300 transition-colors p-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <div class="flex flex-col items-center">
          <nav class="flex flex-col items-center space-y-6 w-full max-w-xs">
            <a href={lang === 'es' ? '/' : '/en/'} class="text-2xl text-amber-50 hover:text-amber-300 transition-colors py-3 w-full text-center border-b border-amber-800">{t.home}</a>
            <a href={lang === 'es' ? '/tours' : '/en/tours'} class="text-2xl text-amber-50 hover:text-amber-300 transition-colors py-3 w-full text-center border-b border-amber-800">{t.tours}</a>
            <a href={lang === 'es' ? '/about' : '/en/about'} class="text-2xl text-amber-50 hover:text-amber-300 transition-colors py-3 w-full text-center border-b border-amber-800">{t.about}</a>
            <a href={lang === 'es' ? '/gallery' : '/en/gallery'} class="text-2xl text-amber-50 hover:text-amber-300 transition-colors py-3 w-full text-center border-b border-amber-800">{t.gallery}</a>
            <a href={lang === 'es' ? '/contact' : '/en/contact'} class="text-2xl text-amber-50 hover:text-amber-300 transition-colors py-3 w-full text-center border-b border-amber-800">{t.contact}</a>
            <a href="https://wa.me/50686394010" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center text-2xl text-amber-50 hover:text-amber-300 transition-colors py-3 w-full text-center border-b border-amber-800">
              <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.5 14.4l-2.2-2.2c-.2-.2-.5-.2-.7 0l-1.6 1.6c-.5-.3-1.3-.6-1.9-.9-.3-.1-.5-.4-.4-.7.3-.8.5-1.7.5-2.7 0-3.1-2.5-5.6-5.6-5.6-.8 0-1.6.2-2.3.5-.3.1-.5.4-.4.7.3 1 .6 1.8 1 2.5.1.2.1.5 0 .7L3.5 9.9c-.2.2-.2.5 0 .7l2.8 2.8c.2.2.5.2.7 0l1.3-1.3c.2-.2.5-.2.7 0 .9.7 1.9 1.2 3 1.4.3 0 .5.3.4.6-.3 1.1-.8 2.1-1.4 2.9-.1.2-.1.5 0 .7l1.4 1.4c.2.2.5.2.7 0l2.8-2.8c.2-.2.5-.2.7 0l1.3 1.3c.2.2.5.2.7 0l2.8-2.8c.2-.2.2-.5 0-.7l-2.2-2.1z"/>
              </svg>
              +506 8639 4010
            </a>
            <a href={lang === 'es' ? '/en' : '/'} class="mt-4 px-6 py-3 rounded-full bg-amber-400 text-amber-900 font-bold text-lg hover:bg-green-600 hover:text-white transition-all transform hover:scale-105 w-full text-center">
              {t.switchLang}
            </a>
          </nav>
        </div>
      </div>
    </div>

    <main class="flex-1 flex flex-col">
      <slot />
    </main>
    <ScrollToTop />
    <footer class="w-full bg-[#381705] text-amber-50 py-6 px-6 mt-10">
      <div class="max-w-6xl mx-auto">
        <div class="flex flex-col md:flex-row items-center justify-between gap-4 text-sm">
          <div>© {new Date().getFullYear()} Rancho Raíces. {lang === 'es' ? 'Todos los derechos reservados.' : 'All rights reserved.'}</div>
          <div class="flex flex-col md:flex-row items-center gap-4">
            <div class="flex items-center">
              <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 2v.5l-8 5.3-8-5.3V6h16zM4 18V9.7l8 5.3 8-5.3V18H4z"/>
              </svg>
              <span>info@ranchoraices.com</span>
            </div>
            <div class="flex items-center">
              <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"/>
              </svg>
              <a href="tel:+50686394010" class="hover:underline">+506 8639 4010</a>
              <span class="mx-2">|</span>
              <a href="https://wa.me/50686394010" target="_blank" rel="noopener noreferrer" class="flex items-center text-green-300 hover:text-green-100">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M17.5 14.4l-2.2-2.2c-.2-.2-.5-.2-.7 0l-1.6 1.6c-.5-.3-1.3-.6-1.9-.9-.3-.1-.5-.4-.4-.7.3-.8.5-1.7.5-2.7 0-3.1-2.5-5.6-5.6-5.6-.8 0-1.6.2-2.3.5-.3.1-.5.4-.4.7.3 1 .6 1.8 1 2.5.1.2.1.5 0 .7L3.5 9.9c-.2.2-.2.5 0 .7l2.8 2.8c.2.2.5.2.7 0l1.3-1.3c.2-.2.5-.2.7 0 .9.7 1.9 1.2 3 1.4.3 0 .5.3.4.6-.3 1.1-.8 2.1-1.4 2.9-.1.2-.1.5 0 .7l1.4 1.4c.2.2.5.2.7 0l2.8-2.8c.2-.2.5-.2.7 0l1.3 1.3c.2.2.5.2.7 0l2.8-2.8c.2-.2.2-.5 0-.7l-2.2-2.1z"/>
                </svg>
                WhatsApp
              </a>
            </div>
          </div>
        </div>
        
        <!-- Redes Sociales -->
        <div class="mt-6 pt-6 border-t border-amber-800">
          <h3 class="text-lg font-display mb-4 text-center md:text-left">Síguenos en redes sociales</h3>
          <div class="flex justify-center md:justify-start gap-6">
            <a href="https://www.facebook.com/RanchoRaices" target="_blank" rel="noopener noreferrer" 
               class="text-amber-50 hover:text-blue-400 transition-colors" 
               aria-label="Facebook de Rancho Raíces">
              <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.563V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"/>
              </svg>
            </a>
            <a href="https://www.instagram.com/ranchoraices/" target="_blank" rel="noopener noreferrer" 
               class="text-amber-50 hover:text-pink-500 transition-colors" 
               aria-label="Instagram de Rancho Raíces">
              <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 0a12 12 0 100 24 12 12 0 000-24zm5.5 17.8l-1.7-1.4-2.7-2.3-2.7 2.3-1.7 1.4-3.2-3.3 1.7-1.4 1.7-1.5-3.2-2.7 1.1-1.3 3.3 2.8V6.5h2.8v4.7l3.3-2.8 1.1 1.3-3.2 2.7 1.7 1.5 1.7 1.4-3.2 3.3z"/>
              </svg>
            </a>
            <a href="https://www.tripadvisor.es/Attraction_Review-g309284-d3174761-Reviews-Rancho_Raices_De_Puerto_Jimenez-Puerto_Jimenez_Osa_Peninsula_Province_of_Puntaren.html" 
               target="_blank" rel="noopener noreferrer" 
               class="text-amber-50 hover:text-green-500 transition-colors" 
               aria-label="TripAdvisor de Rancho Raíces">
              <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 0a12 12 0 100 24 12 12 0 000-24zm5.5 17.8l-1.7-1.4-2.7-2.3-2.7 2.3-1.7 1.4-3.2-3.3 1.7-1.4 1.7-1.5-3.2-2.7 1.1-1.3 3.3 2.8V6.5h2.8v4.7l3.3-2.8 1.1 1.3-3.2 2.7 1.7 1.5 1.7 1.4-3.2 3.3z"/>
              </svg>
            </a>
            <a href="https://maps.app.goo.gl/VsTUBsxhHF4poFcy7" 
               target="_blank" rel="noopener noreferrer" 
               class="text-amber-50 hover:text-red-500 transition-colors" 
               aria-label="Ubicación de Rancho Raíces en Google Maps">
              <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 110-5 2.5 2.5 0 010 5z"/>
              </svg>
            </a>
          </div>
        </div>
        
        <div class="mt-6 text-center md:text-left text-sm">
          <p>Puerto Jiménez, Península de Osa, Costa Rica</p>
        </div>
    </footer>

    <script>
      const menuBtn = document.getElementById('menu-btn');
      const closeMenuBtn = document.getElementById('close-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');
      const mobileMenuContent = mobileMenu?.querySelector('div > div');
      const menuIcon = document.getElementById('menu-icon');
      const closeIcon = document.getElementById('close-icon');
      let isOpen = false;

      function openMenu() {
        if (!isOpen) {
          mobileMenu.classList.remove('opacity-0', 'pointer-events-none');
          mobileMenuContent.classList.remove('translate-y-full');
          document.body.style.overflow = 'hidden';
          menuIcon.classList.add('hidden');
          closeIcon.classList.remove('hidden');
          isOpen = true;
        }
      }

      function closeMenu() {
        if (isOpen) {
          mobileMenuContent.classList.add('translate-y-full');
          mobileMenu.classList.add('opacity-0', 'pointer-events-none');
          document.body.style.overflow = '';
          menuIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
          isOpen = false;
        }
      }

      function toggleMenu() {
        if (isOpen) closeMenu();
        else openMenu();
      }

      // Event Listeners
      menuBtn?.addEventListener('click', toggleMenu);
      closeMenuBtn?.addEventListener('click', closeMenu);

      // Cerrar al hacer clic fuera del menú
      mobileMenu?.addEventListener('click', (e) => {
        if (e.target === mobileMenu) closeMenu();
      });

      // Cerrar menú al hacer clic en un enlace
      document.querySelectorAll('#mobile-menu nav a').forEach(link => {
        link.addEventListener('click', closeMenu);
      });

      // Cerrar con tecla Escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && isOpen) closeMenu();
      });
    </script>
  </body>
</html>